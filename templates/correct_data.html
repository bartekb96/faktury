<!DOCTYPE html>
<html lang="en">
 
<head>
	<meta charset="utf-8">
    <title>Walidacja Faktur Online</title>
	<link href="../static/style.css" rel="stylesheet">
</head>
 
<body>
 
    <div id="container">
        
		<div id="logo">
			<h1>POPRAW DANE FAKTURY</h1>
		</div>

		<div id="datas">
		
			<table class="table-content" align="center">
				<thead>
					<tr>
						<th>OPIS</th>
						<th>ODCZYTANA WARTOŚĆ</th>
						<th>POPRAWIONA WARTOŚĆ</th>
					</tr>
				</thead>
				
				<tbody>
					<tr>
						<td>Numer faktury</td>
						<td>{{invoiceNumber}}</td>
						<td><input type="text" class="corrected-data" value='{{invoiceNumber}}' name="invoiceNumber"></td>
					</tr>
					
					<tr>
						<td>NIP sprzedawcy</td>
						<td>{{sellerNip}}</td>
						<td><input type="text" class="corrected-data" value='{{sellerNip}}' name="sellerNip"></td>
					</tr>
					
					<tr>
						<td>Miasto sprzedawcy</td>
						<td>{{sellerCity}}</td>
						<td><input type="text" class="corrected-data" value='{{sellerCity}}' name="sellerCity"></td>
					</tr>
					
					<tr>
						<td>Adres sprzedawcy</td>
						<td>{{sellerAddress}}</td>
						<td><input type="text" class="corrected-data" value='{{sellerAddress}}' name="sellerAddress"></td>
					</tr>
					
					<tr>
						<td>Nazwa sprzedawcy</td>
						<td>{{sellerName}}</td>
						<td><input type="text" class="corrected-data" value='{{sellerName}}' name="sellerName"></td>
					</tr>
					
					<tr>
						<td>NIP nabywcy</td>
						<td>{{buyerNip}}</td>
						<td><input type="text" class="corrected-data" value='{{buyerNip}}' name="buyerNip"></td>
					</tr>
					
					<tr>
						<td>Miasto nabywcy</td>
						<td>{{buyerCity}}</td>
						<td><input type="text" class="corrected-data" value='{{buyerCity}}' namwe="buyerCity"></td>
					</tr>
					
					<tr>
						<td>Adres nabywcy</td>
						<td>{{buyerAddress}}</td>
						<td><input type="text" class="corrected-data" value='{{buyerAddress}}' name="buyerAddress"></td>
					</tr>
					
					<tr>
						<td>Nazwa nabywcy</td>
						<td>{{buyerName}}</td>
						<td><input type="text" class="corrected-data" value='{{buyerName}}' name="buyerName"></td>
					</tr>
					
					<tr>
						<td>Kwota całkowita</td>
						<td>{{invoiceAmount}}</td>
						<td><input type="text" class="corrected-data" value='{{invoiceAmount}}' name="invoiceAmount"></td>
					</tr>
				</tbody>
			</table>
					
					
			<table class="table-content" align="center" id="positions-table">
				<thead>
					<tr>
						<th>ODCZYTANA NAZWA USŁUGI</th>
						<th>POPRAWIONA NAZWA USŁUGI</th>
						<th>ODCZYTANY KOSZT USŁUGI [PLN]</th>
						<th>POPRAWIONY KOSZT USŁUGIi [PLN]</th>
					</tr>
				</thead>
				
				<tbody>
				
					{% for position in positions %}
						<tr>
							<td>{{ position.positionName }}</td>
							<td><input type="text" class="corrected-data" value='{{ position.positionName }}' name="positionName{{ loop.index }}"></td>
							<td>{{ position.positionAmount }}</td>
							<td><input type="text" class="corrected-data" value='{{ position.positionAmount }}' name="positionAmount{{ loop.index }}"></td>
						</tr>
					{% endfor %}
					
				</tbody>	
			</table>
				
			<button id = "accept-btn" class = "custom-button" onclick="submit_changes();">ZATWIERDŹ FAKTURĘ</button>
			<button type = "button" id = "add-row" class = "custom-button">DODAJ NOWĄ POZYCJĘ</button>
			
		</div>
		
		<div id="footer2">
			<h1>footer</h1>
		</div>
		
    </div>
	
	
	<script>
		const table = document.getElementById("positions-table");
		const addButton = document.getElementById("add-row");

		addButton.addEventListener("click", function() {
			var row = table.insertRow(-1);
			var cell1 = row.insertCell(0);
			var cell2 = row.insertCell(1);
			var cell3 = row.insertCell(2);
			var cell4 = row.insertCell(3);
			cell1.innerHTML = "-";
			cell2.innerHTML = "<input type='text' class='corrected-data'>"; 
			cell3.innerHTML = "-"; 
			cell4.innerHTML = "<input type='text' class='corrected-data'>"; 
		});
		
		function submit_changes() {
		
			var totalRowCount = 0;
			var rowCount = 0;
			var rows = table.getElementsByTagName("tr")
			
			for (var i = 0; i < rows.length; i++) {
				totalRowCount++;
				if (rows[i].getElementsByTagName("td").length > 0) {
					rowCount++;
				}
			}
			
			var data = {
				rows: rowCount
			};
		
			fetch('/correctInvoice', {
				method: 'POST',
				body: JSON.stringify(data)
			})
			.then(function(text) {
				console.log("POST response: " + text);
			})
			.catch(function(error) {
				console.log("Fetch error: " + error);
			});

		}
		
	</script>
	
	
</body>
</html>